<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Weather Watch Face</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0D0D12;
            --bg-secondary: #1A1A21; 
            --text-primary: #F0F0F5;
            --text-secondary: #A0A0B0;
            --bg-glass: rgba(40, 40, 50, 0.7);
            --accent-purple: #C77DFF;
            --forecast-color-1: #FF6B6B;
            --forecast-color-2: #FFD166;
            --forecast-color-3: #06D6A0;
        }

        body, html {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .app-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        /* NEW: Header styles */
        .watch-header {
            position: absolute;
            top: 2vh;
            left: 2vw;
            right: 2vw;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
        }

        .close-btn {
            width: 44px;
            height: 44px;
            background-color: rgba(30, 30, 35, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            font-weight: 300;
            color: var(--text-secondary);
            flex-shrink: 0;
            cursor: pointer;
        }

        .url-bar {
            flex-grow: 1;
            background-color: var(--bg-secondary);
            color: var(--text-secondary);
            padding: 12px 16px;
            border-radius: 14px;
            text-align: left;
            font-size: 15px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-time {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
            flex-shrink: 0;
        }

        .weather-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            padding: 20px;
            box-sizing: border-box;
            animation: fade-in 0.8s cubic-bezier(0.16, 1, 0.3, 1);
            /* MODIFIED: Pushed down to make space for the header */
            margin-top: 12vh;
        }

        .current-weather {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-basis: 50%;
            gap: 5px;
        }

        .current-weather-icon {
            width: 80px;
            height: 80px;
        }

        .current-weather-temp {
            font-size: 88px;
            font-weight: 700;
            line-height: 1;
            letter-spacing: -2px;
        }

        .current-weather-condition {
            font-size: 24px;
            font-weight: 500;
            color: var(--text-secondary);
            text-align: center;
        }

        .hourly-forecast {
            display: flex;
            flex-direction: column;
            gap: 16px;
            background: var(--bg-glass);
            backdrop-filter: blur(12px);
            border-radius: 24px;
            padding: 20px;
            flex-basis: 50%;
        }

        .forecast-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .forecast-temp {
            font-size: 24px;
            font-weight: 600;
        }

        .forecast-icon {
            width: 40px;
            height: 40px;
        }

        .forecast-time {
            font-size: 20px;
            font-weight: 500;
            color: var(--text-secondary);
            width: 60px;
            text-align: right;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes drift {
            0% { transform: translate(-2px, 1px); }
            50% { transform: translate(2px, -1px); }
            100% { transform: translate(-2px, 1px); }
        }

        .animated-cloud {
            animation: drift 12s ease-in-out infinite;
        }
    </style>
</head>
<body>

<div class="app-container">
    <div class="watch-header">
        <div class="close-btn">&times;</div>
        <div class="url-bar">theva73.github.io</div>
        <div class="header-time">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="var(--accent-purple)" viewBox="0 0 16 16">
                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
            </svg>
            <span id="header-time-text">--:--</span>
        </div>
    </div>

    <div class="weather-container">
        <div class="current-weather">
            <div id="current-weather-icon-container"></div>
            <div class="current-weather-temp" id="current-temp">--Â°</div>
            <div class="current-weather-condition" id="current-condition">Loading...</div>
        </div>
        <div class="hourly-forecast" id="hourly-forecast-container">
            <!-- Forecast items will be dynamically injected here -->
        </div>
    </div>
</div>

<script>
    const headerTimeText = document.getElementById('header-time-text');

    function updateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const timeString = `${hours}:${minutes}`;
        if (headerTimeText) {
            headerTimeText.textContent = timeString;
        }
    }

    // --- Weather Logic ---
    const weatherIconMap = {
        0: { description: 'Clear', icon: (color = '#FFD60A') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><circle cx="32" cy="32" r="12" fill="${color}"/></svg>` },
        1: { description: 'Mainly Clear', icon: (color = '#F0F0F5') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M47.7,41.8 C47.2,36.4 43.2,32 38,32 L37.5,32 C36.9,25.1 31.1,19.5 24,19.5 C16.8,19.5 11,25.4 11,32.5 L11,33 L10,33 C6.7,33 4,35.7 4,39 C4,42.3 6.7,45 10,45 L46,45 C49.9,45 53,41.9 53,38 C53,34.9 50.8,32.2 47.9,31.2 Z" fill="${color}" fill-opacity="0.9"/></g><circle cx="30" cy="22" r="7" fill="#FFD60A"/></svg>` },
        2: { description: 'Partly Cloudy', icon: (color = '#F0F0F5') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M46 31 C40 31, 38 35, 38 35 C36 28, 31 26, 26 28 C20 25, 15 30, 15 36 C15 36, 10 36, 10 41 C10 46, 15 46, 15 46 L46 46 C52 46, 55 41, 52 37 C52 37, 51 31, 46 31 Z" fill="${color}" /></g></svg>` },
        3: { description: 'Overcast', icon: (color = '#B0B0C0') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M46 31 C40 31, 38 35, 38 35 C36 28, 31 26, 26 28 C20 25, 15 30, 15 36 C15 36, 10 36, 10 41 C10 46, 15 46, 15 46 L46 46 C52 46, 55 41, 52 37 C52 37, 51 31, 46 31 Z" fill="${color}" /></g></svg>` },
        45: { description: 'Fog', icon: (color = '#A0A0B0') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M12 36 H52" stroke="${color}" stroke-width="6" stroke-linecap="round" opacity="0.8"/><path d="M16 44 H48" stroke="${color}" stroke-width="6" stroke-linecap="round" opacity="0.7"/><path d="M20 52 H44" stroke="${color}" stroke-width="6" stroke-linecap="round" opacity="0.6"/></g></svg>` },
        61: { description: 'Rain', icon: (color = '#0A84FF') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M46 24 C40 24, 38 28, 38 28 C36 21, 31 19, 26 21 C20 18, 15 23, 15 29 C15 29, 10 29, 10 34 C10 39, 15 39, 15 39 L46 39 C52 39, 55 34, 52 30 C52 30, 51 24, 46 24 Z" fill="#606070" /></g><path d="M22 48 L26 54" stroke="${color}" stroke-width="2" stroke-linecap="round"/><path d="M30 50 L34 56" stroke="${color}" stroke-width="2" stroke-linecap="round"/><path d="M38 48 L42 54" stroke="${color}" stroke-width="2" stroke-linecap="round"/></svg>` },
        80: { description: 'Showers', icon: (color = '#0A84FF') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M46 24 C40 24, 38 28, 38 28 C36 21, 31 19, 26 21 C20 18, 15 23, 15 29 C15 29, 10 29, 10 34 C10 39, 15 39, 15 39 L46 39 C52 39, 55 34, 52 30 C52 30, 51 24, 46 24 Z" fill="#606070" /></g><path d="M22 48 L26 54" stroke="${color}" stroke-width="2" stroke-linecap="round"/><path d="M30 50 L34 56" stroke="${color}" stroke-width="2" stroke-linecap="round"/><path d="M38 48 L42 54" stroke="${color}" stroke-width="2" stroke-linecap="round"/></svg>` },
        95: { description: 'Thunderstorm', icon: (color = '#FFD60A') => `<svg class="current-weather-icon" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><g class="animated-cloud"><path d="M46 20 C40 20, 38 24, 38 24 C36 17, 31 15, 26 17 C20 14, 15 19, 15 25 C15 25, 10 25, 10 30 C10 35, 15 35, 15 35 L46 35 C52 35, 55 30, 52 26 C52 26, 51 20, 46 20 Z" fill="#404050" /></g><polygon points="28,42 34,42 30,50 36,50 32,58 32,50 28,50" fill="${color}"/></svg>` }
    };
    
    Object.assign(weatherIconMap, {
        48: weatherIconMap[45], 51: weatherIconMap[61], 53: weatherIconMap[61], 55: weatherIconMap[61], 56: weatherIconMap[61], 57: weatherIconMap[61], 63: weatherIconMap[61], 65: weatherIconMap[61], 66: weatherIconMap[61], 67: weatherIconMap[61], 71: weatherIconMap[80], 73: weatherIconMap[80], 75: weatherIconMap[80], 77: weatherIconMap[80], 81: weatherIconMap[80], 82: weatherIconMap[80], 85: weatherIconMap[80], 86: weatherIconMap[80], 96: weatherIconMap[95], 99: weatherIconMap[95]
    });

    async function fetchWeather() {
        const lat = 1.3521;
        const lon = 103.8198;
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&timezone=Asia/Singapore`;

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            updateWeatherUI(data);
        } catch (error) {
            console.error("Error fetching weather:", error);
            document.getElementById('current-condition').textContent = 'Weather N/A';
        }
    }

    function updateWeatherUI(data) {
        const currentTemp = Math.round(data.current.temperature_2m);
        const currentCode = data.current.weather_code;
        const weatherInfo = weatherIconMap[currentCode] || weatherIconMap[3];

        document.getElementById('current-temp').textContent = `${currentTemp}Â°`;
        document.getElementById('current-condition').textContent = weatherInfo.description;
        document.getElementById('current-weather-icon-container').innerHTML = weatherInfo.icon();

        const hourlyContainer = document.getElementById('hourly-forecast-container');
        hourlyContainer.innerHTML = ''; 

        const now = new Date();
        const startIndex = data.hourly.time.findIndex(time => new Date(time).getHours() === now.getHours());
        if (startIndex === -1) return;

        const forecastColors = ['var(--forecast-color-1)', 'var(--forecast-color-2)', 'var(--forecast-color-3)'];

        for (let i = 0; i < 3; i++) {
            const forecastIndex = startIndex + i + 1;
            if (forecastIndex >= data.hourly.time.length) break;

            const time = new Date(data.hourly.time[forecastIndex]);
            const temp = Math.round(data.hourly.temperature_2m[forecastIndex]);
            const code = data.hourly.weather_code[forecastIndex];
            const hourInfo = weatherIconMap[code] || weatherIconMap[3];
            
            const item = document.createElement('div');
            item.className = 'forecast-item';
            
            const displayHour = time.getHours();
            const ampm = displayHour >= 12 ? 'pm' : 'am';
            const formattedHour = displayHour % 12 === 0 ? 12 : displayHour % 12;

            item.innerHTML = `
                <div class="forecast-temp" style="color: ${forecastColors[i]}">${temp}Â°</div>
                <div class="forecast-icon">${hourInfo.icon(forecastColors[i])}</div>
                <div class="forecast-time">${formattedHour} ${ampm}</div>
            `;
            hourlyContainer.appendChild(item);
        }
    }
    
    // Initial Load & Refresh Intervals
    updateTime();
    fetchWeather();
    setInterval(updateTime, 1000 * 30);
    setInterval(fetchWeather, 1000 * 60 * 15);

</script>

</body>
</html>
